package com.online.flowers.controller;

import java.io.IOException;
import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestAttribute;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;

import com.cloudinary.Singleton;
import com.cloudinary.utils.ObjectUtils;
import com.online.flowers.lib.PhotoUploadValidator;
import com.online.flowers.model.FlowersModel;
import com.online.flowers.model.PhotoUpload;
import com.online.flowers.service.FlowersService;


@RestController
@CrossOrigin(origins = "*")
public class FlowersController {

	@Autowired
	private FlowersService flowerService;
	
	@PostMapping(value = "/add")
	public void addPhoto(@RequestBody PhotoUpload flowerToAdd) {
//		System.out.println(flowerToAdd);
		PhotoUploadValidator validator = new PhotoUploadValidator();
//		validator.validate(flowerToAdd, result);
		
		 Map uploadResult = null;
		 
		 if (flowerToAdd.getFile() != null && !flowerToAdd.getFile().isEmpty()) {
	            try {
					uploadResult = Singleton.getCloudinary().uploader().upload(flowerToAdd.getFile().getBytes(),
					        ObjectUtils.asMap("resource_type", "auto"));
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
	            flowerToAdd.setPublicId((String) uploadResult.get("public_id"));
	            Object version = uploadResult.get("version");
	            if (version instanceof Integer) {
	            	flowerToAdd.setVersion(new Long((Integer) version));    
	            } else {
	            	flowerToAdd.setVersion((Long) version);
	            }
	            
	            flowerToAdd.setSignature((String) uploadResult.get("signature"));
	            flowerToAdd.setFormat((String) uploadResult.get("format"));
	            flowerToAdd.setResourceType((String) uploadResult.get("resource_type"));
	        }
		
//		return flowerService.saveImage(multipartFile, string, string2, string3)
	}

}
