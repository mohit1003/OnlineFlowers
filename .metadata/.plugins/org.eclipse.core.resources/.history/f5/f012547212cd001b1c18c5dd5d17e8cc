package com.online.flowers;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.mock.web.MockMultipartFile;
import org.springframework.test.context.junit4.SpringRunner;

import com.online.flowers.controller.FlowersController;
import com.online.flowers.dto.Customer;
import com.online.flowers.dto.MaxMinSoldFlower;
import com.online.flowers.dto.ReportingForChart;
import com.online.flowers.model.CustomerModel;
import com.online.flowers.model.FlowersModel;

@SpringBootTest
@RunWith(SpringRunner.class)
public class FlowersApplicationControllerTests {

	@MockBean
	private FlowersController _controller;
	
	static Customer customer;

	static CustomerModel customerModel;

	static Map<String, String> image;

	static MockMultipartFile file;

	static MaxMinSoldFlower flower;

	static List<ReportingForChart> charts;

	static ReportingForChart flowerReport;

	static ReportingForChart flowerReport1;

	static FlowersModel flowerModel;
	
	public void setUpCustomer() {
		customer = new Customer("1@2", "MR", "Mohit", "Kulkarni", "123, High street, Brentford, London", "London", "UK",
				"$2a$10$KLQUgWpeYzNT8q48c226I.5BKJZ41TZaKkJU/4H.3FWyjSUEAeu0S", "9921918100");

		customerModel = new CustomerModel("1@2", "MR", "Mohit", "Kulkarni", "123, High street, Brentford, London",
				"London", "UK", "$2a$10$KLQUgWpeYzNT8q48c226I.5BKJZ41TZaKkJU/4H.3FWyjSUEAeu0S", "9921918100");
	}

	public static void setUpCloudinaryMap() {
		image = new HashMap<>();
		image.put("signature", "69465fe2acaeb4d6a752e25821b668bc586b581c");
		image.put("format", "jpg");
		image.put("resource_type", "image");
		image.put("secure_url",
				"https://res.cloudinary.com/dxpstpk9n/image/upload/v1623641592/ubvxivmt6ukbtzgn4mlm.jpg");
		image.put("created_at", "2021-06-14T03:33:12Z");
		image.put("asset_id", "e4d788ab6c7f87368019c2b34f4e5c9e");
		image.put("version_id", "3e7a2efb26a09c596e37b04f6c71eab7");
		image.put("type", "upload");
		image.put("version", "1623641592");
		image.put("url", "http://res.cloudinary.com/dxpstpk9n/image/upload/v1623641592/ubvxivmt6ukbtzgn4mlm.jpg");
		image.put("tags", "[]");
		image.put("original_filename", "SympathyBoque");
		image.put("api_key", "178195379295372");
		image.put("bytes", "10147");
		image.put("width", "160");
		image.put("etag", "08458b81d56cbc453de5653e2b3b4416");
		image.put("placeholder", "false");
		image.put("original_extension", "jpeg");
		image.put("height", "315");

		file = new MockMultipartFile("file", "hello.txt", MediaType.TEXT_PLAIN_VALUE, "Hello, World!".getBytes());
	}

	public void setUpFlower() {
		flowerModel = mock(FlowersModel.class);
		flower.setId(223);
		flower.setCategory("love");
		flower.setDescription("for you");
		flower.setName("Teddy");
		flower.setImageUrl("http://res.cloudinary.com/dxpstpk9n/image/upload/v1623596524/sprlfhvwojmxcaxaus7r.jpg");
		flower.setPrice("500");
	}

	public void setUpmaxMinFlowers() {
		flower = mock(MaxMinSoldFlower.class);
		flower.setId(223);
		flower.setCategory("love");
		flower.setDescription("for you");
		flower.setName("Teddy");
		flower.setImageUrl("http://res.cloudinary.com/dxpstpk9n/image/upload/v1623596524/sprlfhvwojmxcaxaus7r.jpg");
		flower.setPrice("500");
		flower.setQuantity(5);
	}

	public void setUpReportingData() {
		charts = new ArrayList<>();
		flowerReport = mock(ReportingForChart.class);
		flower.setId(223);
		flower.setName("Teddy");
		flower.setPrice("500");
		flower.setQuantity(3);

		flowerReport1 = mock(ReportingForChart.class);
		flower.setId(233);
		flower.setName("Whity");
		flower.setPrice("200");
		flower.setQuantity(8);

		charts.add(flowerReport);
		charts.add(flowerReport1);
	}


	@Test
	public void registerUserTest() {
		setUpCustomer();
		when(_controller.registerUser(customerModel))
				.thenReturn(new ResponseEntity<String>("User is registered", HttpStatus.CREATED));
		assertEquals(new ResponseEntity<String>("User is registered", HttpStatus.CREATED), _controller.registerUser(customerModel));
	}
	
	@AfterAll
	public static void cleanUp() {
		image = null;
		file = null;
		customer = null;
		customerModel = null;
		flower = null;
		charts = null;
		flowerReport = null;
		flowerReport1 = null;
		flowerModel = null;
	}
}
